!function(t,e){"use strict";var i="Taggle";"function"==typeof define&&define.amd?define([],function(){var s=e();return t[i]=s,s}):"object"==typeof module&&module.exports?module.exports=t[i]=e():t[i]=e()}(this,function(){"use strict";function t(){for(var t=arguments[0],e=1,i=arguments.length;e<i;e++){var s=arguments[e];for(var n in s)s.hasOwnProperty(n)&&(t[n]=s[n])}return t}function e(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)}function i(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i}function s(t){return t.replace(/^\s+|\s+$/g,"")}function n(t,e){window.attachEvent&&!window.addEventListener?t.innerText=e:t.textContent=e}var a=function(){},r=function(){return!0},o=8,h=188,l=9,u=13,p={additionalTagClasses:"",allowDuplicates:!1,saveOnBlur:!1,clearOnBlur:!0,duplicateTagClass:"",containerFocusClass:"active",focusInputOnContainerClick:!0,hiddenInputName:"taggles[]",tags:[],delimeter:",",attachTagId:!1,allowedTags:[],disallowedTags:[],maxTags:null,tabIndex:1,placeholder:"Enter tags...",submitKeys:[h,l,u],preserveCase:!1,inputFormatter:a,tagFormatter:a,onBeforeTagAdd:a,onTagAdd:a,onBeforeTagRemove:r,onTagRemove:a},c=function(e,i){this.settings=t({},p,i),this.measurements={container:{rect:null,style:null,padding:null}},this.container=e,this.tag={values:[],elements:[]},this.list=document.createElement("ul"),this.inputLi=document.createElement("li"),this.input=document.createElement("input"),this.sizer=document.createElement("div"),this.pasting=!1,this.placeholder=null,this.settings.placeholder&&(this.placeholder=document.createElement("span")),"string"==typeof e&&(this.container=document.getElementById(e)),this._id=0,this._setMeasurements(),this._setupTextarea(),this._attachEvents()};return c.prototype._setMeasurements=function(){this.measurements.container.rect=this.container.getBoundingClientRect(),this.measurements.container.style=window.getComputedStyle(this.container);var t=this.measurements.container.style,e=parseInt(t["padding-left"]||t.paddingLeft,10),i=parseInt(t["padding-right"]||t.paddingRight,10),s=parseInt(t["border-left-width"]||t.borderLeftWidth,10),n=parseInt(t["border-right-width"]||t.borderRightWidth,10);this.measurements.container.padding=e+i+s+n},c.prototype._setupTextarea=function(){var t;if(this.list.className="taggle_list",this.input.type="text",this.input.style.paddingLeft=0,this.input.style.paddingRight=0,this.input.className="taggle_input",this.input.tabIndex=this.settings.tabIndex,this.sizer.className="taggle_sizer",this.settings.tags.length)for(var e=0,i=this.settings.tags.length;e<i;e++){var s=this._createTag(this.settings.tags[e]);this.list.appendChild(s)}this.placeholder&&(this.placeholder.style.opacity=0,this.placeholder.classList.add("taggle_placeholder"),this.container.appendChild(this.placeholder),n(this.placeholder,this.settings.placeholder),this.settings.tags.length||(this.placeholder.style.opacity=1));var a=this.settings.inputFormatter(this.input);a&&(this.input=a),this.inputLi.appendChild(this.input),this.list.appendChild(this.inputLi),this.container.appendChild(this.list),this.container.appendChild(this.sizer),t=window.getComputedStyle(this.input).fontSize,this.sizer.style.fontSize=t},c.prototype._attachEvents=function(){var t=this;this.settings.focusInputOnContainerClick&&i(this.container,"click",function(){t.input.focus()}),i(this.input,"focus",this._focusInput.bind(this)),i(this.input,"blur",this._blurEvent.bind(this)),i(this.input,"keydown",this._keydownEvents.bind(this)),i(this.input,"keyup",this._keyupEvents.bind(this))},c.prototype._fixInputWidth=function(){var t,e,i,s,n;this._setMeasurements(),this._setInputWidth(),e=this.input.getBoundingClientRect(),i=this.measurements.container.rect,t=~~i.width,t||(t=~~i.right-~~i.left),s=~~e.left-~~i.left,n=this.measurements.container.padding,this._setInputWidth(t-s-n)},c.prototype._canAdd=function(t,e){if(!e)return!1;var i=this.settings.maxTags;if(null!==i&&i<=this.getTagValues().length)return!1;if(this.settings.onBeforeTagAdd(t,e)===!1)return!1;if(!this.settings.allowDuplicates&&this._hasDupes(e))return!1;var s=this.settings.preserveCase,n=this.settings.allowedTags;if(n.length&&!this._tagIsInArray(e,n,s))return!1;var a=this.settings.disallowedTags;return!a.length||!this._tagIsInArray(e,a,s)},c.prototype._tagIsInArray=function(t,e,i){if(i)return e.indexOf(t)!==-1;var s=[].slice.apply(e).map(function(t){return t.toLowerCase()});return s.indexOf(t)!==-1},c.prototype._add=function(t,e){var i=this,n=e||"";"string"!=typeof e&&(n=s(this.input.value)),n.split(this.settings.delimeter).map(function(t){return i._formatTag(t)}).forEach(function(e){if(i._canAdd(t,e)){var s=i._createTag(e),n=i.list.children,a=n[n.length-1];i.list.insertBefore(s,a),e=i.tag.values[i.tag.values.length-1],i.settings.onTagAdd(t,e),i.input.value="",i._fixInputWidth(),i._focusInput()}})},c.prototype._checkLastTag=function(t){t=t||window.event;var e=this.container.querySelectorAll(".taggle"),i=e[e.length-1],s="taggle_hot",n=this.input.classList.contains("taggle_back");""!==this.input.value||t.keyCode!==o||n?i.classList.contains(s)&&i.classList.remove(s):i.classList.contains(s)?(this.input.classList.add("taggle_back"),this._remove(i,t),this._fixInputWidth(),this._focusInput()):i.classList.add(s)},c.prototype._setInputWidth=function(t){this.input.style.width=(t||10)+"px"},c.prototype._hasDupes=function(t){var e,i=this.tag.values.indexOf(t),s=this.container.querySelector(".taggle_list");if(this.settings.duplicateTagClass){e=s.querySelectorAll("."+this.settings.duplicateTagClass);for(var n=0,a=e.length;n<a;n++)e[n].classList.remove(this.settings.duplicateTagClass)}return i>-1&&(this.settings.duplicateTagClass&&s.childNodes[i].classList.add(this.settings.duplicateTagClass),!0)},c.prototype._isConfirmKey=function(t){var e=!1;return this.settings.submitKeys.indexOf(t)>-1&&(e=!0),e},c.prototype._focusInput=function(){this._fixInputWidth(),this.container.classList.contains(this.settings.containerFocusClass)||this.container.classList.add(this.settings.containerFocusClass),this.placeholder&&(this.placeholder.style.opacity=0)},c.prototype._blurEvent=function(t){if(this.container.classList.contains(this.settings.containerFocusClass)&&this.container.classList.remove(this.settings.containerFocusClass),this.settings.saveOnBlur){if(t=t||window.event,this._listenForEndOfContainer(),""!==this.input.value)return void this._confirmValidTagEvent(t);this.tag.values.length&&this._checkLastTag(t)}else this.settings.clearOnBlur&&(this.input.value="",this._setInputWidth());this.tag.values.length||!this.placeholder||this.input.value||(this.placeholder.style.opacity=1)},c.prototype._keydownEvents=function(t){t=t||window.event;var e=t.keyCode;return this.pasting=!1,this._listenForEndOfContainer(),86===e&&t.metaKey&&(this.pasting=!0),this._isConfirmKey(e)&&""!==this.input.value?void this._confirmValidTagEvent(t):void(this.tag.values.length&&this._checkLastTag(t))},c.prototype._keyupEvents=function(t){t=t||window.event,this.input.classList.remove("taggle_back"),n(this.sizer,this.input.value),this.pasting&&""!==this.input.value&&(this._add(t),this.pasting=!1)},c.prototype._confirmValidTagEvent=function(t){t=t||window.event,t.preventDefault?t.preventDefault():t.returnValue=!1,this._add(t)},c.prototype._listenForEndOfContainer=function(){var t=this.sizer.getBoundingClientRect().width,e=this.measurements.container.rect.width-this.measurements.container.padding,i=parseInt(this.sizer.style.fontSize,10);t+1.5*i>parseInt(this.input.style.width,10)&&(this.input.style.width=e+"px")},c.prototype._createTag=function(t){var e=document.createElement("li"),s=document.createElement("button"),a=document.createElement("input"),r=document.createElement("span");t=this._formatTag(t),s.innerHTML="&times;",s.className="close",s.type="button",i(s,"click",this._remove.bind(this,s)),n(r,t),r.className="taggle_text",e.className="taggle "+this.settings.additionalTagClasses,a.type="hidden",a.value=t,a.name=this.settings.hiddenInputName,e.appendChild(r),e.appendChild(s),e.appendChild(a);var o=this.settings.tagFormatter(e);if("undefined"!=typeof o&&(e=o),!(e instanceof HTMLElement)||"LI"!==e.tagName)throw new Error("tagFormatter must return an li element");return this.settings.attachTagId&&(this._id+=1,t={text:t,id:this._id}),this.tag.values.push(t),this.tag.elements.push(e),e},c.prototype._remove=function(t,e){function i(i){i||(t.parentNode.removeChild(t),r.tag.elements.splice(a,1),r.tag.values.splice(a,1),r.settings.onTagRemove(e,s),r._focusInput())}var s,n,a,r=this;"li"!==t.tagName.toLowerCase()&&(t=t.parentNode),n="a"===t.tagName.toLowerCase()?t.parentNode:t,a=this.tag.elements.indexOf(n),s=this.tag.values[a];var o=this.settings.onBeforeTagRemove(e,s,i);o&&i()},c.prototype._formatTag=function(t){return this.settings.preserveCase?t:t.toLowerCase()},c.prototype.getTags=function(){return{elements:this.getTagElements(),values:this.getTagValues()}},c.prototype.getTagElements=function(){return this.tag.elements},c.prototype.getTagValues=function(){return[].slice.apply(this.tag.values)},c.prototype.getInput=function(){return this.input},c.prototype.getContainer=function(){return this.container},c.prototype.add=function(t){var i=e(t);if(i)for(var s=0,n=t.length;s<n;s++)"string"==typeof t[s]&&this._add(null,t[s]);else this._add(null,t);return this},c.prototype.remove=function(t,e){for(var i=this.tag.values.length-1,s=!1;i>-1;){var n=this.tag.values[i];if(this.settings.attachTagId&&(n=n.text),n===t&&(s=!0,this._remove(this.tag.elements[i])),s&&!e)break;i--}return this},c.prototype.removeAll=function(){for(var t=this.tag.values.length-1;t>=0;t--)this._remove(this.tag.elements[t]);return this},c.prototype.setOptions=function(e){return this.settings=t({},this.settings,e||{}),this},c});